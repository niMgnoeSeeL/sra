{
  "$schema": "https://schema.store/schemas/json/tasks.json",
  "version": "2.0.0",
  "options": {
    "cwd": "${workspaceFolder}"
  },
  "tasks": [
    {
      "label": "AFL: build",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "make -C AFLplusplus -j$(nproc)"
      ],
      "problemMatcher": [
        "$gcc"
      ],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      "label": "AFL: clean",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "make -C AFLplusplus clean"
      ]
    },
    {
      "label": "Generate compile_commands.json (AFL++)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "rm -f compile_commands.json && bear --output compile_commands.json -- make -j$(nproc) -C AFLplusplus"
      ],
      "problemMatcher": []
    },
    {
      "label": "Generate compile_commands.json (FT)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "rm -f compile_commands.json && bear --output compile_commands.json -- make -j$(nproc) -C AFLplusplus"
      ],
      "problemMatcher": []
    },
    {
      "label": "sense:cmake-config-debug",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "/usr/bin/cmake -S .. -B . -DLLVM_DIR=\"$(llvm-config-20 --cmakedir)\" -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON"
      ],
      "options": {
        "cwd": "${workspaceFolder}/sense/build"
      },
      "problemMatcher": [],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      "label": "sense:build-all",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "/usr/bin/cmake --build . -j"
      ],
      "options": {
        "cwd": "${workspaceFolder}/sense/build"
      },
      "problemMatcher": []
    },
    {
      "label": "sense:emit-ll",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "clang-20 -O0 -S -emit-llvm -Xclang -disable-O0-optnone ../demo/demo.c -I ../runtime -o demo.ll"
      ],
      "options": {
        "cwd": "${workspaceFolder}/sense/build"
      },
      "problemMatcher": []
    },
    {
      "label": "sense:mutate-ll",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "opt-20 -load-pass-plugin=./MutArgsPass.so -passes=\"function(mut-args)\" -mut-only-fns=f -S demo.ll -o demo.mut.ll"
      ],
      "options": {
        "cwd": "${workspaceFolder}/sense/build"
      },
      "problemMatcher": []
    },
    {
      "label": "sense:sample",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "SAMPLE_ONLY_FNS=f clang-20 -O0 -Xclang -disable-O0-optnone -fpass-plugin=./SampleArgsPass.so ../demo/demo.c -L. -lsample_runtime -o demo"
      ],
      "options": {
        "cwd": "${workspaceFolder}/sense/build"
      },
      "problemMatcher": []
    },
    {
      "label": "sense:build-mut-demo",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "clang-20 demo.mut.ll libmut_runtime.a -o demo_mut"
      ],
      "options": {
        "cwd": "${workspaceFolder}/sense/build"
      },
      "problemMatcher": []
    },
    {
      "label": "sense:build-sample-demo",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "clang-20 demo.sample.ll libsample_runtime.a -o demo_sample"
      ],
      "options": {
        "cwd": "${workspaceFolder}/sense/build"
      },
      "problemMatcher": []
    },
    {
      "label": "dynamo:cmake-config",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "mkdir -p build && cd build && cmake -DDynamoRIO_DIR=$DYNAMORIO_HOME/cmake .. -DCMAKE_EXPORT_COMPILE_COMMANDS=ON"
      ],
      "options": {
        "cwd": "${workspaceFolder}/sense/dynamo"
      },
      "problemMatcher": []
    },
    {
      "label": "dynamo:build",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "cmake --build build -j"
      ],
      "options": {
        "cwd": "${workspaceFolder}/sense/dynamo"
      },
      "problemMatcher": [
        "$gcc"
      ],
      "dependsOn": [
        "dynamo:cmake-config"
      ]
    }
  ]
}